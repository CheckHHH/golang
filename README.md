Для запуска оркестратора и агентов сначала необходимо перейти на страницу https://github.com/CheckHHH/golang.

Убедитесь, что у вас установлен Docker. Если нет, вы можете установить его, следуя инструкциям на https://docs.docker.com/engine/install/.

Затем выполните клонирование репозитория https://github.com/CheckHHH/golang с помощью Git, если у вас установлен Git:

bash
Copy code
git clone https://github.com/CheckHHH/golang
Затем перейдите в корневую папку проекта и выполните следующую команду. (ВНИМАНИЕ: порты 8080, 7777 и 5433 должны быть доступны! Если они заняты и вам нужны, отредактируйте файл .env в папке Orchestrator/config и docker-compose.yaml. Если изменяется ORCHESTRATOR_TCP_PORT, не забудьте изменить соответствующую настройку в агенте (в папке Agent/config) и отредактировать параметр PORT.)

Copy code
docker compose up
или

Copy code
docker-compose up
После запуска контейнеров вы сможете перейти по адресу http://localhost:8080/.

Для запуска оркестратора выполните:

go
Copy code
go run cmd/orchestrator/main.go
Затем вернитесь в корневую папку проекта. Перейдите в папку Agent и запустите агент командой:

go
Copy code
go run cmd/orchestrator/main.go
Запуск базы данных возлагается на вас. Для корректной работы базы вам нужно запустить (или выполнить запрос) файл yandex.sql из папки sql корневого каталога проекта в запущенной PostgreSQL. База данных должна называться orchestrator, или вы можете изменить имя в настройках Orchestrator на любое другое.

Настройки оркестратора
Все настройки находятся в файле ./Orchestrator/config/.env и в docker-compose.yaml для образа Docker. ORCHESTRATOR_HTTP_PORT - настройка порта HTTP для работы сервера по протоколу HTTP. ORCHESTRATOR_TCP_PORT - настройка для работы TCP сервера. TCP сервер необходим для работы с агентом. ORCHESTRATOR_DB - адрес базы данных. ORCHESTRATOR_DB_NAME - название базы данных. ORCHESTRATOR_DB_PORT - порт для подключения к базе данных. ORCHESTRATOR_DB_USER - имя пользователя для базы данных. ORCHESTRATOR_DB_PASSWORD - пароль для базы данных.

Настройки агента
Все настройки находятся в файле ./Agent/config/.env и в docker-compose.yaml для образа Docker. HOST - имя или IP-адрес оркестратора. PORT - порт оркестратора. MAX_GOROUTINES_AGENT - количество горутин у агента.

Описание API оркестратора
Можно использовать curl, Postman или другие инструменты для отправки данных на оркестратор. Также можно использовать визуальное отображение через веб-браузер. Доступны следующие API:

"/" - любой запрос вернет HTML файл сгенерированный для подключения к оркестратору.
"/duration" - метод POST устанавливает нужное время для каждой арифметической операции. Метод GET возвращает текущие настройки времени или значения по умолчанию, если настроек нет.
"/expression" - метод POST принимает нужное выражение для вычисления. Поддерживаются операции "+", "-", "*", "/", а также скобки "(". Пробелы игнорируются. Если значение некорректное, система возвращает статус 400 и описание ошибки. При успешном вычислении возвращается выражение с его ID, датой создания, датой завершения и текущим статусом. Если выражение уже было введено ранее, возвращается его ID и статус.
"/id/{id}" - принимает ID выражения и возвращает его, если оно найдено. В противном случае возвращается статус 400 и ошибка.
"/workers" - метод GET возвращает количество запущенных агентов, общее количество горутин всех агентов, занятые горутины (ворекры), которые обрабатывают текущую операцию, и массив обрабатываемых на данный момент операций.
Принцип работы программы
Вычисление выражения. Пользователь вводит выражение. Оркестратор принимает и валидирует его. После успешной валидации создается AST дерево выражения, разбивая его на операции. Выражение сохраняется в мапе (или в базе данных, если доступно соединение с ней), а затем начинается вычисление. Каждая операция помещается в очередь по порядку добавления и ожидает запроса данных от агента. Когда агент подключается к оркестратору (каждый воркер подключается в своей горутине), запрашивая данные, они извлекаются из очереди по порядку, записываются в мапу очереди и отправляются агенту для вычисления. Воркеры агента не поддерживают постоянное соединение с оркестратором. После вычисления агент возвращает результат операции или ошибку, если вычисление не удалось. Оркестратор принимает результат и сохраняет его в мап
